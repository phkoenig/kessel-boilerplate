---
description: Supabase-Projekt-Konfiguration und CLI-Nutzung.
globs: ["**/utils/supabase/**", "supabase/**", "**/pull-env.mjs"]
alwaysApply: false
---

# Supabase-Projekt

## Infra-DB (KESSEL)

Die Boilerplate nutzt **KESSEL** als Infra-DB für alle Infrastruktur-Daten:

| Projekt    | Ref                    | Enthält                                      |
| ---------- | ---------------------- | -------------------------------------------- |
| **KESSEL** | `ufqlocxqizmiaozkashi` | Auth, Profiles, Themes, Roles, Vault/Secrets |

> **KESSEL = Infra-DB.** Keine App-spezifischen Business-Daten hier!
> Für App-Daten → separate Dev-DB (siehe `docs/architecture/database-architecture.md`)

## CLI-Befehle

```bash
# Projekt verlinken (einmalig)
npx supabase link --project-ref ufqlocxqizmiaozkashi

# Migrationen pushen (nach Link)
npx supabase db push --linked --include-all --yes

# Tabellen prüfen
npx supabase inspect db table-sizes --linked

# Storage Buckets
npx supabase storage ls --linked --experimental
```

## Migrationen ausführen

**WICHTIG:** Nach `supabase link` funktioniert `db push` automatisch ohne Database-Password!

```bash
# 1. Projekt verlinken (einmalig)
npx supabase link --project-ref ufqlocxqizmiaozkashi

# 2. Migration erstellen
cp scripts/meine_migration.sql supabase/migrations/012_meine_migration.sql

# 3. Migration pushen
npx supabase db push --linked --include-all --yes
```

## Secrets abrufen

```bash
# Secrets aus Vault laden
pnpm pull-env
```

Die Secrets werden aus `vault.secrets` im KESSEL-Projekt gelesen und in `.env.local` geschrieben.

## Tabellen im Projekt

| Schema | Tabellen |
|--------|----------|
| `public` | `profiles`, `themes`, `roles`, `role_permissions` |
| `vault` | `secrets` (für API-Keys, etc.) |
| `storage` | `themes` Bucket |

## Dokumentation

→ Architektur: `docs/architecture/database-architecture.md`
→ Secrets: `docs/guides/secrets-management.md`
→ Migrationen: `docs/guides/supabase-migrationen.md`
