---
description: Spezifische Anweisungen für das Schreiben von Unit- und Integrationstests (Vitest/Jest).
globs: ["**/*.test.ts", "**/*.spec.ts", "**/*.test.tsx", "**/*.spec.tsx"]
---

# TEST-RICHTLINIEN

Du befindest dich in einer Test-Datei. Alle hier generierten Tests MÜSSEN den folgenden Standards entsprechen.

## STRUKTUR (Arrange-Act-Assert)

Verwende konsequent das "Arrange-Act-Assert" (AAA) Pattern für alle Tests:

- **Arrange:** Richte das Setup ein (Mocks, Testdaten, Instanzen).
- **Act:** Führe die zu testende Funktion oder Methode aus.
- **Assert:** Überprüfe das Ergebnis mit `expect()`.
- Trenne diese Blöcke visuell durch eine Leerzeile, um die Lesbarkeit zu erhöhen.

## MOCKING

- Mocke nur externe Abhängigkeiten (z.B. APIs, Datenbanken, `Date.now()`). Teste nicht die Implementierungsdetails von internen Modulen.
- Verwende `vi.mock` oder `jest.mock` auf der Top-Ebene der Datei.
- Setze Mocks vor jedem Test zurück (z.B. mit `vi.clearAllMocks()` in einem `beforeEach` Block).

## BEISPIEL-TEST (Vitest)

```typescript
import { fetchUserProfile } from './user.service';
import { api } from './api/api.client'; // Angenommen, dies ist der gemockte Client
import { UserProfile } from './types/user';
import { UserNotFoundError } from './errors/errors';

// Arrange: Mocke das API-Modul
vi.mock('./api/api.client');

describe('fetchUserProfile', () => {
  beforeEach(() => {
    vi.clearAllMocks(); // Wichtig für saubere Tests
  });

  it('sollte das Benutzerprofil bei Erfolg zurückgeben', async () => {
    // Arrange
    const mockProfile: UserProfile = { id: '1', email: 'test@test.com' };
    vi.mocked(api.get).mockResolvedValue({ data: mockProfile });

    // Act
    const result = await fetchUserProfile('1');

    // Assert
    expect(result).toEqual(mockProfile);
    expect(api.get).toHaveBeenCalledWith('/users/1');
  });

  it('sollte einen UserNotFoundError werfen, wenn die API 404 zurückgibt', async () => {
    // Arrange
    vi.mocked(api.get).mockRejectedValue({ status: 404 });

    // Act & Assert
    await expect(fetchUserProfile('unknown-id')).rejects.toThrow(UserNotFoundError);
  });
});
```
