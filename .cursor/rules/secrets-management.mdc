---
description: Secrets & Environment Management via Supabase Vault. Gilt für alle Operationen mit Umgebungsvariablen.
alwaysApply: true
---

# Secrets & Environment Management

## Architektur: Zwei Supabase-Projekte

| Projekt | Zweck | Variablen |
|---------|-------|-----------|
| **Vault** | Secrets-Speicherung | In `.env`: `NEXT_PUBLIC_SUPABASE_URL` (Vault-URL), `SERVICE_ROLE_KEY` |
| **Daten** | App-Daten, Storage | In `.env.local`: `NEXT_PUBLIC_SUPABASE_URL` (Daten-URL), `NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY` |

## Dateien

| Datei | Inhalt | Git |
|-------|--------|-----|
| `.env` | Bootstrap: Vault-URL + SERVICE_ROLE_KEY | ❌ ignoriert |
| `.env.local` | Public-Keys für Daten-Projekt (via `pnpm pull-env`) | ❌ ignoriert |

## Workflow

1. **Setup:** `.env` enthält Vault-Credentials (manuell oder via CLI)
2. **Pull:** `pnpm pull-env` → liest Vault → schreibt `.env.local`
3. **Dev:** `pnpm dev` → liest `.env.local`
4. **Vercel:** Secrets als Environment Variables setzen (aus Vault exportieren)

## Regeln

- `SERVICE_ROLE_KEY` nur serverseitig (nie `NEXT_PUBLIC_*`, nie im Client-Code)
- Alle Secrets im Supabase Vault speichern (keine externe Plattform)
- `pnpm pull-env` vor jedem Dev-Start ausführen (bei Secret-Änderungen)

## Vercel Deployment

- `NEXT_PUBLIC_*` Variablen: Als "Public" setzen
- Server-Secrets (`SERVICE_ROLE_KEY`): Als "Private" setzen (nicht Public!)
- Secrets für alle Environments setzen: Production, Preview, Development
